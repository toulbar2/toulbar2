

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pytoulbar2 &mdash; toulbar2 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/toulbar2.css?v=4cefacce" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            toulbar2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../presentation.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmark libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/usecases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userdoc.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refman.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pdfmanuals.html">Documentation in pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">toulbar2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div class=toulbar2header>

  <div class="toulbar2logo">

    <h1>toulbar2</h1>
    <h2>An exact solver for cost function networks</h2>

  </div>

  <div class=toulbar2headerline>

    <a href=../presentation.html>Presentation</a> |
    <a href=../downloads.html>Downloads</a> |
    <a href=../benchmarks.html>Benchmarks</a> |
    <a href=../examples/tutorials.html>Tutorials</a> |
    <a href=../examples/usecases.html>Use cases</a> |
    <a href=../userdoc.html>User</a> |
    <a href=../refman.html>Reference</a> |
    <a href=../pdfmanuals.html>Doc in pdf</a> |
    <a href=../publications.html>Publications</a>

  </div>

</div>

<!-- News : see news_*.rst pages -->

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pytoulbar2</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Help on module pytoulbar2:</span>

<span class="sd">NAME</span>
<span class="sd">    pytoulbar2 - Python3 interface of toulbar2.</span>

<span class="sd">DESCRIPTION</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isinf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="k">try</span> <span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pytoulbar2.pytb2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tb2</span>
    <span class="n">tb2</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="CFN">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CFN</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;pytoulbar2 base class used to manipulate and solve a cost function network.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        ubinit (decimal cost or None): initial upper bound.</span>
<span class="sd">        resolution (int): decimal precision of costs.</span>
<span class="sd">        vac (int): if non zero, maximum solver depth minus one where virtual arc consistency algorithm is applied (1: VAC only in preprocessing).</span>
<span class="sd">        configuration (bool): if True then special settings for preference learning using incremental solving (see car configuration tutorial).</span>
<span class="sd">        vns (int or None): if None then solves using branch-and-bound methods else using variable neighborhood search heuristic</span>
<span class="sd">                           (-1: initial solution at random, -2: minimum domain values, -3: maximum domain values, </span>
<span class="sd">                            -4: first solution found by DFS, &gt;=0: or by LDS with at most vns discrepancies).</span>
<span class="sd">        seed (int): random seed.</span>
<span class="sd">        verbose (int): verbosity control (-1: no message, 0: search statistics, 1: search tree, 2-7: propagation information).</span>
<span class="sd">        init (bool): starts from scratch, forgets previous CFNs (default value is True). Must be set to False if this CFN depends on a previous CFN (e.g. this CFN is given as input to a AddWeightedCSPConstraint). </span>
<span class="sd">    </span>
<span class="sd">    Members:</span>
<span class="sd">        CFN (WeightedCSPSolver): python interface to C++ class WeightedCSPSolver.</span>
<span class="sd">        </span>
<span class="sd">        Contradiction (exception): python exception corresponding to the same C++ class.</span>
<span class="sd">        </span>
<span class="sd">        Limit (exception|None): contains the last SolverOut exception or None if no exception occurs when solving with SolveNext.</span>
<span class="sd">        </span>
<span class="sd">        Option (TouBar2): python interface to C++ class ToulBar2.</span>
<span class="sd">        </span>
<span class="sd">        SolverOut (exception): python exception corresponding to the same C++ class.</span>
<span class="sd">        </span>
<span class="sd">        Top (decimal cost): maximum decimal cost (it can be used to represent a forbidden cost).</span>
<span class="sd">        </span>
<span class="sd">        Variables (dict): associative array returning the original domain (list or iterable) associated to a given variable name (str).</span>
<span class="sd">        </span>
<span class="sd">        VariableIndices (dict): associative array returning the variable name (str) associated to a given index (int).</span>
<span class="sd">        </span>
<span class="sd">        VariableNames (list): array of created variable names (str) sorted by their index number.</span>
<span class="sd">        </span>
<span class="sd">    See pytoulbar2test.py example in src repository.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ubinit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vac</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">configuration</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span> <span class="o">=</span> <span class="n">resolution</span>   <span class="c1"># decimal precision of costs</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">vac</span> <span class="o">=</span> <span class="n">vac</span>   <span class="c1"># if no zero, maximum search depth-1 where VAC algorithm is performed (use 1 for preprocessing only)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>    <span class="c1"># random seed number (use -1 if a pseudo-randomly generated seed is wanted)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>   <span class="c1"># verbosity level of toulbar2 (-1:no message, 0:search statistics, 1:search tree, 2-7: propagation information)</span>

        <span class="c1"># default options (can be modified later by the user)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">FullEAC</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># if True, exploit VAC integrality variable orderding heuristic or just Full-EAC heuristic if VAC diseable</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">VACthreshold</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># if True, reuse VAC auto-threshold value found in preprocessing during search </span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">useRASPS</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># if 1 or greater, perform iterative RASPS depth-first search (or LDS if greater than 1) in preprocessing during 1000 backtracks to find a good initial upperbound (to be used with VAC)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">weightedTightness</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># if 1 or 2, variable ordering heuristic exploiting cost distribution information (0: none, 1: mean cost, 2: median cost)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">configuration</span>   <span class="c1"># if True then special settings for learning</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">elimDegree_preprocessing</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># maximum degree level of variable elimination in preprocessing (-1: none, 0: null degree, 1: degree one, etc.)</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">solutionBasedPhaseSaving</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1">#  if False do not reuse previous complete solutions as hints during incremental solving used by structure learning evaluation procedure!</span>

        <span class="k">if</span> <span class="n">vns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">vnsInitSol</span> <span class="o">=</span> <span class="n">vns</span>   <span class="c1"># if vns different than None then perform Decomposition-Guided Variable Neighborhood Search (-1: initial solution at random, -2: minimum domain values, -3: maximum domain values, -4: first solution found by DFS, &gt;=0: or by LDS with at most vns discrepancies)</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">lds</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">restart</span> <span class="o">=</span> <span class="mi">10000</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">searchMethod</span> <span class="o">=</span> <span class="mi">2</span>    <span class="c1"># 0:DFBB or HBFS, 1:VNS, 2:DGVNS 4:Parallel DGVNS</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">vnsNeighborVarHeur</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># 0: random, 1:conflict, 3: decomposition</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span> <span class="c1"># initialize VAC algorithm depending on tb2.option.vac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InternalCFNs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="c1"># keep alive internal CFNs created by AddWeightedCSPConstraint</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span> <span class="o">=</span> <span class="n">ubinit</span> <span class="c1"># warning! cannot convert initial upper bound into an integer cost before knowing the rest of the problem        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Contradiction</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Contradiction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolverOut</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">SolverOut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Option</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Top</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="c1"># can be used to represent forbidden assignments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>    <span class="c1"># checks compatibility between selected options</span>

<div class="viewcode-block" id="CFN.flatten">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.flatten">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Warning: this recursive method might exceed maximum recursion depth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">S</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="n">S</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CFN</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">CFN</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">S</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CFN</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="CFN.AddVariable">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddVariable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddVariable creates a new discrete variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): variable name.</span>
<span class="sd">            values (list or iterable): list of domain values represented by numerical (int) or symbolic (str) values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Index of the created variable in the problem (int).</span>
<span class="sd">            </span>
<span class="sd">        Note:</span>
<span class="sd">            Symbolic values are implicitely associated to integer values (starting from zero) in the other functions.</span>
<span class="sd">            In case of numerical values, the initial domain size is equal to max(values)-min(values)+1 and not equal to len(values).</span>
<span class="sd">            Otherwise (symbolic case), the initial domain size is equal to len(values).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot; already defined&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
            <span class="n">vIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">makeEnumeratedVariable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">vn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">addValueName</span><span class="p">(</span><span class="n">vIdx</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vn</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">vn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">vIdx</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
            <span class="n">vIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">makeEnumeratedVariable</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vn</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">addValueName</span><span class="p">(</span><span class="n">vIdx</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Incorrect domain:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vIdx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vIdx</span></div>


<div class="viewcode-block" id="CFN.AddFunction">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddFunction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddFunction creates a cost function in extension. The scope corresponds to the input variables of the function. </span>
<span class="sd">        The costs are given by a flat array the size of which corresponds to the product of initial domain sizes (see note in AddVariable and also GetDomainInitSize). </span>
<span class="sd">     </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (list): input variables of the function. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            costs (list): array of decimal costs for all possible assignments (iterating first over the domain values of the last variable in the scope).</span>
<span class="sd">            incremental (bool): if True then the function is backtrackable (i.e., it disappears when restoring at a lower depth, see Store/Restore).  </span>

<span class="sd">        Example:</span>
<span class="sd">            AddFunction([&#39;x&#39;,&#39;y&#39;], [0,1,1,0]) encodes a binary cost function on Boolean variables x and y such that (x=0,y=0) has a cost of 0,</span>
<span class="sd">            (x=0,y=1) has a cost of 1, (x=1,y=0) has a cost of 1, and (x=1,y=1) has a cost of 0.</span>
<span class="sd">           </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Duplicate variable in scope:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> 
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">costs</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mincost</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
        <span class="n">maxcost</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mincost</span> <span class="o">==</span> <span class="n">maxcost</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">mincost</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">costs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postUnaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">costs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">costs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postTernaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">incremental</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Sorry, incremental &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;-arity cost functions not implemented yet in toulbar2.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">mincost</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintBegin</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span> <span class="o">-</span> <span class="n">costs</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="nb">tuple</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iscope</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">cost</span> <span class="ow">in</span> <span class="n">costs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isinf</span><span class="p">(</span><span class="n">cost</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintTuple</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">cost</span> <span class="o">&gt;</span> <span class="n">mincost</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintTuple</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">cost</span><span class="o">-</span><span class="n">mincost</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">iscope</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="nb">tuple</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)):</span>
                            <span class="nb">tuple</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintEnd</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddCompactFunction">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddCompactFunction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddCompactFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">defcost</span><span class="p">,</span> <span class="n">tuples</span><span class="p">,</span> <span class="n">tcosts</span><span class="p">,</span> <span class="n">incremental</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddCompactFunction creates a cost function in extension. The scope corresponds to the input variables of the function. </span>
<span class="sd">        The costs are given by a list of assignments with the corresponding list of costs, all the other assignments taking the default cost. </span>
<span class="sd">     </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (list): input variables of the function. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            defcost (decimal cost): default cost.</span>
<span class="sd">            tuples (list): array of assignments (each assignment is a list of domain values, following the scope order).</span>
<span class="sd">            tcosts (list): array of corresponding decimal costs (tcosts and tuples have the same size).</span>
<span class="sd">            incremental (bool): if True then the function is backtrackable (i.e., it disappears when restoring at a lower depth, see Store/Restore).  </span>

<span class="sd">        Example:</span>
<span class="sd">            AddCompactFunction([&#39;x&#39;,&#39;y&#39;,&#39;z&#39;],0,[[0,0,0],[1,1,1]],[1,-1]) encodes a ternary cost function with the null assignment having a cost of 1,</span>
<span class="sd">            the identity assignment having a cost of -1, and all the other assignments a cost of 0.</span>
<span class="sd">           </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcosts</span><span class="p">))</span>
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Duplicate variable in scope:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> 
            
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">defcost</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mincost</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">defcost</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">tcosts</span><span class="p">))</span>
        <span class="n">maxcost</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">defcost</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tcosts</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mincost</span> <span class="o">==</span> <span class="n">maxcost</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">mincost</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">defcost</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
                <span class="n">costs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">tcosts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postUnaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">defcost</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
                <span class="n">costs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">tcosts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">defcost</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
                <span class="n">costs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">tcosts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postTernaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">incremental</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Sorry, incremental &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;-arity cost functions not implemented yet in toulbar2.&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNullaryConstraint</span><span class="p">(</span><span class="n">mincost</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintBegin</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span> <span class="k">if</span> <span class="n">isinf</span><span class="p">(</span><span class="n">defcost</span><span class="p">)</span> <span class="k">else</span> <span class="nb">int</span><span class="p">((</span><span class="n">defcost</span> <span class="o">-</span> <span class="n">mincost</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcosts</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintTuple</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)],</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span> <span class="k">if</span> <span class="n">isinf</span><span class="p">(</span><span class="n">tcosts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">else</span> <span class="nb">int</span><span class="p">((</span><span class="n">tcosts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mincost</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postNaryConstraintEnd</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="CFN.AddLinearConstraint">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddLinearConstraint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddLinearConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">operand</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">rightcoef</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddLinearConstraint creates a linear constraint with integer coefficients.</span>
<span class="sd">        The scope corresponds to the variables involved in the left part of the constraint. </span>
<span class="sd">        All variables must belong to the left part (change their coefficient sign if they are originally in the right part). </span>
<span class="sd">        All constant terms must belong to the rigt part.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            coefs (list or int): array of integer coefficients associated to the left-part variables (or the same integer coefficient is applied to all variables).</span>
<span class="sd">            scope (list): variables involved in the left part of the constraint. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            operand (str): can be either &#39;==&#39; or &#39;&lt;=&#39; or &#39;&lt;&#39; or &#39;&gt;=&#39; or &#39;&gt;&#39;.</span>
<span class="sd">            rightcoef (int): constant term in the right part.</span>
<span class="sd">           </span>
<span class="sd">        Example:</span>
<span class="sd">            AddLinearConstraint([1,1,-2], [x,y,z], &#39;==&#39;, -1) encodes x + y -2z = -1. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">coefs</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">scope</span><span class="p">]</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown operand in AddLinearConstraint: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">operand</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> 
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">):</span>
            <span class="n">coefs_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">iscope_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iscope</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sscope</span><span class="p">:</span>
                    <span class="n">coefs_</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">v</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                	<span class="n">index</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iscope_</span><span class="p">)</span>
                	<span class="n">coefs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                	<span class="n">iscope_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                	<span class="n">sscope</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope_</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">))</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">coefs_</span>
            <span class="n">iscope</span> <span class="o">=</span> <span class="n">iscope_</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">rightcoef</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">rightcoef</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iscope</span><span class="p">):</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">valindex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">valindex</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">valindex</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postKnapsackConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">kp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="o">-</span><span class="n">rightcoef</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="n">rightcoef</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iscope</span><span class="p">):</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">valindex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">valindex</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">valindex</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postKnapsackConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">kp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddSumConstraint">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddSumConstraint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddSumConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">operand</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">rightcoef</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddSumConstraint creates a linear constraint with unit coefficients.</span>
<span class="sd">        The scope corresponds to the variables involved in the left part of the constraint.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (list): variables involved in the left part of the constraint. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            operand (str): can be either &#39;==&#39; or &#39;&lt;=&#39; or &#39;&lt;&#39; or &#39;&gt;=&#39; or &#39;&gt;&#39;.</span>
<span class="sd">            rightcoef (int): constant term in the right part.</span>
<span class="sd">           </span>
<span class="sd">        Example:</span>
<span class="sd">            AddSumConstraint([x,y,z], &#39;&lt;&#39;, 3) encodes x + y + z &lt; 3. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddLinearConstraint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">rightcoef</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddGeneralizedLinearConstraint">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddGeneralizedLinearConstraint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddGeneralizedLinearConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuples</span><span class="p">,</span> <span class="n">operand</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">rightcoef</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddGeneralizedLinearConstraint creates a linear constraint with integer coefficients associated to domain values. </span>
<span class="sd">        The scope implicitely corresponds to the variables involved in the tuples. Missing domain values have an implicit zero coefficient. </span>
<span class="sd">        All constant terms must belong to the right part.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            tuples (list): array of triplets (variable, domain value, coefficient) in the left part of the constraint.</span>
<span class="sd">            operand (str): can be either &#39;==&#39; or &#39;&lt;=&#39; or &#39;&lt;&#39; or &#39;&gt;=&#39; or &#39;&gt;&#39;.</span>
<span class="sd">            rightcoef (int): constant term in the right part.</span>
<span class="sd">           </span>
<span class="sd">        Example:</span>
<span class="sd">            AddGeneralizedLinearConstraint([(&#39;x&#39;,1,1),(&#39;y&#39;,1,1),(&#39;z&#39;,0,2)], &#39;==&#39;, 1) encodes (x==1) + (y==1) + 2*(z==0) = 1 assuming 0/1 variables and (x==u) is equal to 1 if value u is assigned to x else equal to 0. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sscope</span><span class="p">:</span>
                <span class="n">sscope</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="n">operand</span> <span class="o">!=</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown operand in AddGeneralizedLinearConstraint: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">operand</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> 

        <span class="k">if</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">rightcoef</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">rightcoef</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iscope</span><span class="p">:</span>
                <span class="n">vtuples</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">coef</span><span class="p">)]</span> <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tuples</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">==</span><span class="n">v</span><span class="p">)]</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtuples</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vtuples</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postKnapsackConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">kp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">or</span> <span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="o">-</span><span class="n">rightcoef</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">operand</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="n">rightcoef</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iscope</span><span class="p">:</span>
                <span class="n">vtuples</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">coef</span><span class="p">)]</span> <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tuples</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">==</span><span class="n">v</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var</span><span class="o">==</span><span class="n">v</span><span class="p">)]</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtuples</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vtuples</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postKnapsackConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">kp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddAllDifferent">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddAllDifferent">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddAllDifferent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">excepted</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">incremental</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add AllDifferent hard global constraint.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (list): input variables of the function. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            encoding (str): encoding used to represent AllDifferent (available choices are &#39;binary&#39; or &#39;salldiff&#39; or &#39;salldiffdp&#39; or &#39;salldiffkp&#39; or &#39;walldiff&#39;).</span>
<span class="sd">            excepted (None or list): list of excepted domain values which can be taken by any variable without violating the constraint.</span>
<span class="sd">            incremental (bool): if True then the constraint is backtrackable (i.e., it disappears when restoring at a lower depth, see Store/Restore).</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">incremental</span> <span class="ow">and</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s1">&#39;binary&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Implementation of AllDifferent constraint requires &#39;binary&#39; encoding in incremental mode!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">excepted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s1">&#39;binary&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Excepted domain values in AllDifferent constraint requires &#39;binary&#39; encoding!&quot;</span><span class="p">)</span>
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Duplicate variable in scope:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;binary&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iscope</span><span class="p">)):</span>
                        <span class="n">costs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">excepted</span> <span class="ow">and</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">excepted</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">excepted</span><span class="p">))))</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">j</span><span class="p">]))]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">iscope</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">costs</span><span class="p">,</span> <span class="n">incremental</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;salldiff&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;flow&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;salldiffdp&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;DAG&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;salldiffkp&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;hard&quot;</span><span class="p">,</span> <span class="s2">&quot;knapsack&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;salldiffeq&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;hardeq&quot;</span><span class="p">,</span> <span class="s2">&quot;knapsack&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;salldiffge&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;hardge&quot;</span><span class="p">,</span> <span class="s2">&quot;knapsack&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">encoding</span><span class="o">==</span><span class="s1">&#39;walldiff&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWAllDiff</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="s2">&quot;hard&quot;</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MAX_COST</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown encoding for AllDifferent: &quot;</span><span class="o">+</span><span class="n">encoding</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddGlobalFunction">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddGlobalFunction">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddGlobalFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">gcname</span><span class="p">,</span> <span class="o">*</span><span class="n">parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddGlobalFunction creates a soft global cost function. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (list): input variables of the function. A variable can be represented by its name (str) or its index (int).</span>
<span class="sd">            gcname (str): name of the global cost function (see toulbar2 user documentation).</span>
<span class="sd">            parameters (list): list of parameters (str or int) for this global cost function.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            AddGlobalFunction([&#39;x1&#39;,&#39;x2&#39;,&#39;x3&#39;,&#39;x4&#39;], &#39;wamong&#39;, &#39;hard&#39;, 1000, 2, 1, 2, 1, 3) encodes a hard among constraint satisfied iff values {1,2} are assigned to the given variables at least once and at most 3 times, otherwise it returns a cost of 1000.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sscope</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sscope</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Duplicate variable in scope:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">))[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postGlobalFunction</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">gcname</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.AddWeightedCSPConstraint">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.AddWeightedCSPConstraint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">AddWeightedCSPConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">duplicateHard</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">strongDuality</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;AddWeightedCSPConstraint creates a hard global constraint on the cost of an input weighted constraint satisfaction problem such that its valid solutions must have a cost value in [lb,ub[. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            problem (CFN): input problem.</span>
<span class="sd">            lb (decimal cost): any valid solution in the input problem must have a cost greater than or equal to lb.</span>
<span class="sd">            ub (decimal cost): any valid solution in the input problem must have a cost strictly less than ub.</span>
<span class="sd">            duplicateHard (bool): if True then it assumes any forbidden tuple in the original input problem is also forbidden by another constraint in the main model (you must duplicate any hard constraints in your input model into the main model).</span>
<span class="sd">            strongDuality (bool): if True then it assumes the propagation is complete when all channeling variables in the scope are assigned and the semantic of the constraint enforces that the optimum and ONLY the optimum on the remaining variables is between lb and ub.</span>
<span class="sd">            </span>
<span class="sd">        Note:</span>
<span class="sd">            If a variable in the input problem does not exist in the current problem (with the same name), it is automatically added.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            m=tb2.CFN(); m.Read(&quot;master.cfn&quot;);s=tb2.CFN();s.Read(&quot;slave.cfn&quot;);m.AddWeightedCSPConstraint(s, lb, ub);m.Solve()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iscope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">vname</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vname</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AddVariable</span><span class="p">(</span><span class="n">vname</span><span class="p">,</span> <span class="p">[(</span><span class="n">problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getValueName</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getValueName</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">problem</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">vname</span><span class="p">)])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Out of range variable index:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; for variable &quot;</span><span class="o">+</span><span class="n">scope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iscope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">multicfn</span> <span class="o">=</span> <span class="n">MultiCFN</span><span class="p">()</span>
        <span class="n">multicfn</span><span class="o">.</span><span class="n">PushCFN</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">negproblem</span> <span class="o">=</span> <span class="n">CFN</span><span class="p">(</span><span class="n">vac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Option</span><span class="o">.</span><span class="n">vac</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Option</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Option</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">init</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">negproblem</span><span class="o">.</span><span class="n">InitFromMultiCFN</span><span class="p">(</span><span class="n">multicfn</span><span class="p">)</span>
        <span class="n">negproblem</span><span class="o">.</span><span class="n">UpdateUB</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">problem</span><span class="o">.</span><span class="n">GetLB</span><span class="p">())</span>
        <span class="c1"># keep alive both problem and negproblem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InternalCFNs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InternalCFNs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">negproblem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">postWeightedCSPConstraint</span><span class="p">(</span><span class="n">iscope</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="p">,</span> <span class="n">negproblem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">DoubletoCost</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">DoubletoCost</span><span class="p">(</span><span class="n">ub</span><span class="p">),</span> <span class="n">duplicateHard</span><span class="p">,</span> <span class="n">strongDuality</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="CFN.Read">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Read">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read reads the problem from a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): problem filename.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">numberOfVariables</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.Parse">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Parse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">certificate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse performs a list of elementary reduction operations on domains of variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            certificate (str): a string composed of a list of operations on domains, each operation in the form &#39;,varIndex[=#&lt;&gt;]value&#39; </span>
<span class="sd">                               where varIndex (int) is the index of a variable as returned by AddVariable and value (int) is a domain value</span>
<span class="sd">                               (comma is mandatory even for the first operation, add no space).</span>
<span class="sd">                               Possible operations are: assign (&#39;=&#39;), remove (&#39;#&#39;), decrease maximum value (&#39;&lt;&#39;), increase minimum value (&#39;&gt;&#39;).</span>
<span class="sd">                               </span>
<span class="sd">        Example:</span>
<span class="sd">            Parse(&#39;,0=1,1=1,2#0&#39;): assigns the first and second variable to value 1 and remove value 0 from the third variable. </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">parse_solution</span><span class="p">(</span><span class="n">certificate</span><span class="p">,</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>    <span class="c1"># WARNING! False: do not reuse certificate in future searches used by structure learning evaluation procedure!</span></div>


<div class="viewcode-block" id="CFN.Dump">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Dump">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dump outputs the problem in a file (without doing any preprocessing).</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): problem filename. The suffix must be &#39;.wcsp&#39; or &#39;.cfn&#39; to select in which format to save the problem.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">updateDUb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;.wcsp&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getNegativeLb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning! Problem optimum has been&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; multiplied by &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span><span class="p">)</span> <span class="k">if</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; and&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getNegativeLb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">decimalPoint</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; shifted by &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getNegativeLb</span><span class="p">())</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getNegativeLb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; in wcp format&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">dump_wcsp</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;.cfn&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">dump_wcsp</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error unknown format!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.Print">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Print">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print prints the content of the CFN (variables, cost functions).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetNbVars">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetNbVars">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetNbVars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetNbVars returns the number of variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of variables (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">numberOfVariables</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.Domain">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Domain">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Domain returns the current domain of a given variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of domain values (list).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getEnumDomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.GetDomainInitSize">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetDomainInitSize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetDomainInitSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetDomainInitSize returns the initial domain size of a given variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Initial domain size (int). See also GetValue, GetValueName, and GetValueIndex.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDomainInitSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.GetValue">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetValue">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetValue returns the value at position index in the initial domain of a given variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            index (int): index of the value in the initial domain of the variable (see also GetDomainInitSize).</span>

<span class="sd">        Returns:</span>
<span class="sd">            domain value (int). In symbolic domains, the returned value is equal to index (see note in AddVariable).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.GetValueName">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetValueName">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetValueName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetValueName returns the symbolic value at position index in the initial domain of a given variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            index (int): index of the value in the initial domain of the variable (see also GetDomainInitSize).</span>

<span class="sd">        Returns:</span>
<span class="sd">            symbolic name corresponding to a domain value (str).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getValueName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span></div>


<div class="viewcode-block" id="CFN.GetValueIndex">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetValueIndex">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetValueIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetValueIndex returns the position index in the initial domain of a given variable which corresponds to the given value.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            value (int|str): domain value (or its symbolic name).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Index of the value in the initial domain of the variable (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">toIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.GetNbConstrs">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetNbConstrs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetNbConstrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetNbConstrs returns the number of non-unary cost functions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of non-unary cost functions (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">numberOfConstraints</span><span class="p">()</span></div>

 
<div class="viewcode-block" id="CFN.GetLB">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetLB">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetLB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetLB returns the current problem lower bound.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current lower bound (decimal cost).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDDualBound</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetUB">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetUB">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetUB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetUB returns the initial upper bound.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current initial upper bound (decimal cost).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDPrimalBound</span><span class="p">()</span></div>


    <span class="c1"># use only for decreasing current upper bound</span>
<div class="viewcode-block" id="CFN.UpdateUB">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.UpdateUB">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">UpdateUB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;UpdateUB decreases the initial upper bound to a given value. Does nothing if this value is greater than the current upper bound.</span>

<span class="sd">        Args:</span>
<span class="sd">            cost (decimal cost): new initial upper bound.</span>
<span class="sd">            </span>
<span class="sd">        Warning:</span>
<span class="sd">            This operation might generate a Contradiction if the new upper bound is lower than or equal to the problem lower bound.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">updateDUb</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">enforceUb</span><span class="p">()</span>   <span class="c1"># this might generate a Contradiction exception</span></div>


<div class="viewcode-block" id="CFN.GetNbNodes">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetNbNodes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetNbNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetNbNodes returns the number of search nodes explored so far.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current number of search nodes (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">getNbNodes</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetNbBacktracks">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetNbBacktracks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetNbBacktracks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetNbBacktracks returns the number of backtracks done so far.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current number of backtracks (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">getNbBacktracks</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetSolutions">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetSolutions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetSolutions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetSolutions returns all the solutions found so far with their associated costs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of pairs (decimal cost, solution) where a solution is a list of domain values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetDDualBound">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetDDualBound">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetDDualBound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetDDualBound returns the global problem lower bound in minimization (resp. upper bound in maximization) found after doing an incomplete search with Solve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Global lower bound (decimal cost).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">getDDualBound</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.GetName">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.GetName">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetName get the name of the CFN.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of the CFN (string).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.SetName">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.SetName">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SetName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SetName set the name of the CFN.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the new name of the CFN.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="CFN.NoPreprocessing">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.NoPreprocessing">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">NoPreprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;NoPreprocessing deactivates most preprocessing methods.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">elimDegree</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">elimDegree_preprocessing</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">preprocessTernaryRPC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">preprocessFunctional</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">costfuncSeparate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">preprocessNary</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">DEE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">MSTDAC</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">trwsAccuracy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>

        
    <span class="c1"># non-incremental solving method</span>
<div class="viewcode-block" id="CFN.Solve">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Solve">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showSolutions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">allSolutions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">diversityBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timeLimit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">writeSolution</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve solves the problem (i.e., finds its optimum and proves optimality). It can also enumerate (diverse) solutions depending on the arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            showSolutions (int): prints solution(s) found (0: show nothing, 1: domain values, 2: variable names with their assigned values, </span>
<span class="sd">                                                               3: variable and value names).</span>
<span class="sd">            allSolutions (int): if non-zero, enumerates all the solutions with a cost strictly better than the initial upper bound</span>
<span class="sd">                                    until a given limit on the number of solutions is reached.</span>
<span class="sd">            diversityBound (int): if non-zero, finds a greedy sequence of diverse solutions where a solution in the list is optimal</span>
<span class="sd">                                      such that it also has a Hamming-distance from the previously found solutions greater than a given bound.</span>
<span class="sd">                                      The number of diverse solutions is bounded by the argument value of allSolutions.</span>
<span class="sd">            timeLimit (int): CPU-time limit in seconds (or 0 if no time limit)</span>
<span class="sd">            writeSolution (str): write best solution found in a file using a given file name and using the same format as showSolutions (or write all solutions if allSolutions is non-zero)</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The best (or last if enumeration/diversity) solution found as a list of domain values, its associated cost, always strictly lower </span>
<span class="sd">            than the initial upper bound, and the number of solutions found (returned type: tuple(list, decimal cost, int)).</span>
<span class="sd">            or None if no solution has been found (the problem has no solution better than the initial upper bound or a search limit occurs).</span>
<span class="sd">            See GetSolutions to retrieve of the solutions found so far.</span>
<span class="sd">            See GetDDualBound to retrieve of the global problem dual bound found so far.</span>
<span class="sd">            </span>
<span class="sd">        Warning:</span>
<span class="sd">            This operation cannot be called multiple times on the same CFN object (it may modify the problem or its upper bound).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">showSolutions</span> <span class="o">=</span> <span class="n">showSolutions</span>   <span class="c1"># show solutions found (0: none, 1: value indexes, 2: value names, 3: variable and value names if available)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">writeSolution</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">showSolutions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">writeSolution</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">showSolutions</span><span class="p">))</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">writeSolution</span><span class="p">(</span><span class="n">writeSolution</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">allSolutions</span> <span class="o">=</span> <span class="n">allSolutions</span>   <span class="c1"># find all solutions up to a given maximum limit (or 0 if searching for the optimum)</span>
        <span class="k">if</span> <span class="n">diversityBound</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">allSolutions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">divNbSol</span> <span class="o">=</span> <span class="n">allSolutions</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">divBound</span> <span class="o">=</span> <span class="n">diversityBound</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">divMethod</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">initDivVariables</span><span class="p">()</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>    <span class="c1"># checks compatibility between selected options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="n">timeLimit</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">updateDUb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">sortConstraints</span><span class="p">()</span>
        <span class="n">solved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">writeSolution</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">closeSolution</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">allSolutions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">())</span> <span class="c1"># returns the last solution found</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solution</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDPrimalBound</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solutions</span><span class="p">())</span> <span class="c1"># returns the best solution found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1"># incremental solving: perform initial preprocessing before all future searches, return improved ub</span>
<div class="viewcode-block" id="CFN.SolveFirst">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.SolveFirst">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SolveFirst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SolveFirst performs problem preprocessing before doing incremental solving.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Initial upper bound (decimal cost), possibly improved by considering a worst-case situation</span>
<span class="sd">            based on the sum of maximum finite cost per function plus one.</span>
<span class="sd">            or None if the problem has no solution (a contradiction occurs during preprocessing).</span>
<span class="sd">            </span>
<span class="sd">        Warning:</span>
<span class="sd">            This operation must be done at solver depth 0 (see Depth).</span>
<span class="sd">        Warning:</span>
<span class="sd">            This operation cannot be called multiple times on the same CFN object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">updateDUb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UbInit</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>    <span class="c1"># checks compatibility between selected options</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Depth</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">sortConstraints</span><span class="p">()</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getUb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">beginSolve</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Contradiction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">whenContradiction</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem has no solution!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">Cost2ADCost</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span></div>


    <span class="c1"># incremental solving: change initial upper bound up and down before adding any problem modifications</span>
<div class="viewcode-block" id="CFN.SetUB">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.SetUB">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SetUB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SetUB resets the initial upper bound to a given value. It should be done before modifying the problem.</span>

<span class="sd">        Args:</span>
<span class="sd">            cost (decimal cost): new initial upper bound.</span>

<span class="sd">        Warning:</span>
<span class="sd">            This operation should be called after SolveFirst and before SolveNext.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">icost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">DoubletoCost</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">timerStop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">setUb</span><span class="p">(</span><span class="n">icost</span><span class="p">)</span>  <span class="c1"># must be done after problem loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">initSolutionCost</span><span class="p">()</span>  <span class="c1"># important to notify previous best found solution is no more valid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">enforceUb</span><span class="p">()</span>   <span class="c1"># this might generate a Contradiction exception</span></div>


    <span class="c1"># incremental solving: find the next (optimal) solution after a problem modification (see also SetUB)</span>
<div class="viewcode-block" id="CFN.SolveNext">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.SolveNext">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SolveNext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showSolutions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timeLimit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SolveNext solves the problem (i.e., finds its optimum and proves optimality). </span>
<span class="sd">        It should be done after calling SolveFirst and modifying the problem if necessary using SetUB, Assign, MultipleAssign, Remove, Increase, Decrease, or adding an incremental cost function.</span>

<span class="sd">        Args:</span>
<span class="sd">            showSolutions (int): prints solution(s) found (0: show nothing, 1: domain values, 2: variable names with their assigned values,</span>
<span class="sd">                                                               3: variable and value names).  </span>
<span class="sd">            timeLimit (int): CPU-time limit in seconds (or 0 if no time limit)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The best solution found as a list of domain values, its associated cost, always strictly lower </span>
<span class="sd">            than the initial upper bound, and None (returned type: tuple(list, decimal cost, None)).</span>
<span class="sd">            or None if no solution has been found (the problem has no solution better than the initial upper bound or a search limit occurs, see Limit).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">showSolutions</span> <span class="o">=</span> <span class="n">showSolutions</span>   <span class="c1"># show solutions found (0: none, 1: value indexes, 2: value names, 3: variable and value names if available)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>    <span class="c1"># checks compatibility between selected options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">timeLimit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="n">timeLimit</span><span class="p">)</span>
        <span class="n">initub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getUb</span><span class="p">()</span>
        <span class="n">initdepth</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">getDepth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">beginSolve</span><span class="p">(</span><span class="n">initub</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">hbfs</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># reinitialize this parameter which can be modified during hybridSolve()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">hybridSolve</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Contradiction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">whenContradiction</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">tb2</span><span class="o">.</span><span class="n">SolverOut</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Limit</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">initdepth</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getSolutionCost</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">initub</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">solution</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getDPrimalBound</span><span class="p">(),</span> <span class="kc">None</span>   <span class="c1"># warning! None: does not return number of found solutions because it is two slow to retrieve all solutions in python</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1"># The following functions allow user-defined search procedures:</span>
    
<div class="viewcode-block" id="CFN.Depth">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Depth">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Depth returns the current solver depth value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Current solver depth value (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">getDepth</span><span class="p">()</span></div>


    <span class="c1"># make a copy (incremental) of the current problem and move to Depth+1</span>
<div class="viewcode-block" id="CFN.Store">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Store">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store makes a copy (incremental) of the current problem and increases the solver depth by one.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">store</span><span class="p">()</span></div>


    <span class="c1"># restore previous copy made at a given depth</span>
<div class="viewcode-block" id="CFN.Restore">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Restore">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore retrieves the copy made at a given solver depth value.</span>

<span class="sd">        Args:</span>
<span class="sd">            depth (int): solver depth value. It must be lower than the current solver depth.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.Assign">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Assign">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign assigns a variable to a domain value.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            value (int): domain value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddCompactFunction</span><span class="p">([</span><span class="n">var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="p">,</span> <span class="p">[[</span><span class="n">value</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="CFN.MultipleAssign">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.MultipleAssign">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">MultipleAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MultipleAssign assigns several variables at once.</span>

<span class="sd">        Args:</span>
<span class="sd">            vars (list): list of indexes or names of variables.</span>
<span class="sd">            values (list): list of domain values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">assignLS</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">],</span> <span class="n">values</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AddCompactFunction</span><span class="p">([</span><span class="nb">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="p">,</span> <span class="p">[[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="CFN.Remove">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Remove">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove removes a value from the domain of a variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            value (int): domain value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddCompactFunction</span><span class="p">([</span><span class="n">var</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[[</span><span class="n">value</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="CFN.Increase">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Increase">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Increase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increase removes the first values strictly lower than a given value in the domain of a variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            value (int): domain value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">increase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddFunction</span><span class="p">([</span><span class="n">var</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDomainInitSize</span><span class="p">(</span><span class="n">var</span><span class="p">))])</span></div>

        
<div class="viewcode-block" id="CFN.Decrease">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Decrease">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Decrease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decrease removes the last values strictly greater than a given value in the domain of a variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>
<span class="sd">            value (int): domain value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Incremental</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">decrease</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AddFunction</span><span class="p">([</span><span class="n">var</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDomainInitSize</span><span class="p">(</span><span class="n">var</span><span class="p">))])</span></div>

            
        
<div class="viewcode-block" id="CFN.Deconnect">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.Deconnect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Deconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deconnect deconnects a variable from the rest of the problem and assigns it to its support value.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (int|str): variable name or its index as returned by AddVariable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">varIndexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">varIndexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MultipleDeconnect</span><span class="p">(</span><span class="n">varIndexes</span><span class="p">)</span></div>


<div class="viewcode-block" id="CFN.MultipleDeconnect">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.MultipleDeconnect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">MultipleDeconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MultipleDeconnect deconnects a set of variables from the rest of the problem and assigns them to their support value.</span>

<span class="sd">        Args:</span>
<span class="sd">            vars (list): list of indexes or names of variables.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">deconnect</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="CFN.ClearPropagationQueues">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.ClearPropagationQueues">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ClearPropagationQueues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ClearPropagationQueues resets propagation queues. It should be called when an exception Contradiction occurs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">whenContradiction</span><span class="p">()</span></div>


<div class="viewcode-block" id="CFN.InitFromMultiCFN">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.CFN.InitFromMultiCFN">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">InitFromMultiCFN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multicfn</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[],</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[],</span> <span class="n">constrs</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;InitFromMultiCFN initializes the cfn from a multiCFN instance (linear combination of multiple CFNs).</span>

<span class="sd">        Args:</span>
<span class="sd">            multicfn (MultiCFN): the instance containing the CFNs.</span>
<span class="sd">            vars (list&lt;int|str&gt;): the list of variable indexes to extract the induced graph (if empty then no restriction)</span>
<span class="sd">            scopes (list&lt;set&lt;int|str&gt;&gt;): the list of allowed scopes to extract the partial graph (if empty then no restriction)</span>
<span class="sd">            constrs (list&lt;int&gt;): the list of allowed cost function indexes (same index as stored in MultiCFN) to extract the partial graph (if empty then no restriction)</span>
<span class="sd">            </span>
<span class="sd">        Note:</span>
<span class="sd">            After beeing initialized, it is possible to add cost functions to the CFN but the upper bound may be inconsistent.</span>
<span class="sd">            The problem lower bound of multicfn is exported only if no restrictions are given (or if scopes contains the emptyset).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">multicfn</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">makeWeightedCSP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="n">multicfn</span><span class="o">.</span><span class="n">GetVariableIndex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">]),</span> <span class="p">[</span><span class="nb">set</span><span class="p">([</span><span class="n">multicfn</span><span class="o">.</span><span class="n">GetVariableIndex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">scope</span><span class="p">])</span> <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">constrs</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">numberOfVariables</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VariableIndices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VariableNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Variables</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Domain</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        
        <span class="k">return</span></div>
</div>


<div class="viewcode-block" id="MultiCFN">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiCFN</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;pytoulbar2 base class used to combine linearly multiple CFNs. See (InitFromMultiCFN) to extract and solve it.</span>
<span class="sd">    </span>
<span class="sd">    Members:</span>
<span class="sd">        MultiCFN: python interface to C++ class MultiCFN.</span>
<span class="sd">            </span>
<span class="sd">    Note:</span>
<span class="sd">        It is important to set the parameter (resolution) to the same ***nonzero*** value when creating every CFN to be pushed in a MultiCFN object.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span> <span class="o">=</span> <span class="n">tb2</span><span class="o">.</span><span class="n">MultiCFN</span><span class="p">()</span>

        <span class="k">return</span>
    
<div class="viewcode-block" id="MultiCFN.PushCFN">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.PushCFN">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">PushCFN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CFN</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;PushCFN add a CFN to the instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            CFN (CFN): the new CFN to add.</span>
<span class="sd">            weight (float): the initial weight of the CFN in the combination.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">CFN</span><span class="o">.</span><span class="n">UbInit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">CFN</span><span class="o">.</span><span class="n">SetUB</span><span class="p">(</span><span class="n">CFN</span><span class="o">.</span><span class="n">UbInit</span><span class="p">)</span> <span class="c1"># might throw a contradiction</span>

        <span class="c1"># this should be done in the CFN class, but the update occurs only when solving the problem</span>
        <span class="c1"># this is because DoubletoCost function depends on the negCost and LB, which may be updated when adding cost functions</span>
        <span class="c1"># if CFN.UbInit is not None:</span>
            <span class="c1"># CFN.CFN.wcsp.updateDUb(CFN.UbInit)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CFN</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">wcsp</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span></div>



<div class="viewcode-block" id="MultiCFN.SetWeight">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.SetWeight">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">SetWeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfn_index</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;SetWeight set a weight of a CFN.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfn_index (int): index of the CFN (in addition order).</span>
<span class="sd">            weight (float): the new weight of the CFN.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">setWeight</span><span class="p">(</span><span class="n">cfn_index</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span></div>



<div class="viewcode-block" id="MultiCFN.GetVariableIndex">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.GetVariableIndex">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetVariableIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetVariableIndex returns the index of the variable in the combined cfn</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of the variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The index of the variable or -1 if not found (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">getVariableIndex</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiCFN.GetNbCFN">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.GetNbCFN">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetNbCFN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetNbCFN returns the number of CFN pushd in the MultiCFN.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of CFN (int).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">nbNetworks</span><span class="p">()</span></div>


<div class="viewcode-block" id="MultiCFN.GetSolution">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.GetSolution">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetSolution returns the solution of the combined cfn after being solved.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The solution of the cfn (dic).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">getSolution</span><span class="p">()</span></div>



<div class="viewcode-block" id="MultiCFN.GetSolutionCosts">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.GetSolutionCosts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">GetSolutionCosts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GetSolutionCosts returns the costs of the combined cfn after being solved.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The costs of the solution of the cfn (list).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">getSolutionValues</span><span class="p">()</span></div>


<div class="viewcode-block" id="MultiCFN.ApproximateParetoFront">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.ApproximateParetoFront">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ApproximateParetoFront</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_criterion</span><span class="p">,</span> <span class="n">first_direction</span><span class="p">,</span> <span class="n">second_criterion</span><span class="p">,</span> <span class="n">second_direction</span><span class="p">,</span> <span class="n">showSolutions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timeLimit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timeLimit_per_solution</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_sol_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ApproximateParetoFront returns the set of supported solutions of the problem on two criteria (on the convex hull of the non dominated solutions).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            first_criterion (int): index of the first CFN to optimize.</span>
<span class="sd">            first_direction (str): direction of the first criterion: &#39;min&#39; or &#39;max&#39;.</span>
<span class="sd">            second_criterion (int): index of the second CFN to optimize.</span>
<span class="sd">            second_direction (str): direction of the second criterion: &#39;min&#39; or &#39;max&#39;.</span>
<span class="sd">            showSolutions (int): prints all intermediate (dominated and nondominated) solution(s) found (0: show nothing, 1: domain values, 2: variable names with their assigned values,</span>
<span class="sd">                                                               3: variable and value names).  </span>
<span class="sd">            timeLimit (int): CPU-time limit in seconds for the whole method (0 by default, meaning no time limit)</span>
<span class="sd">            timeLimit_per_solution (int): CPU-time limit in seconds for the computation of each solution (0 by default, meaning no time limit)</span>
<span class="sd">            max_sol_count (int): limit the maximum number of solutions to compute (0 by default, meaning no limit)</span>


<span class="sd">        Returns:</span>
<span class="sd">            The non dominated solutions belonging to the convex hull of the pareto front and their costs (tuple).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">optim_dir_first</span> <span class="o">=</span> <span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">OptimDir</span><span class="o">.</span><span class="n">Min</span> <span class="k">if</span> <span class="n">first_direction</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span>  <span class="k">else</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">OptimDir</span><span class="o">.</span><span class="n">Max</span><span class="p">)</span>
        <span class="n">optim_dir_second</span> <span class="o">=</span> <span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">OptimDir</span><span class="o">.</span><span class="n">Min</span> <span class="k">if</span> <span class="n">second_direction</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="k">else</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">OptimDir</span><span class="o">.</span><span class="n">Max</span><span class="p">)</span>

        <span class="c1"># parameters</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setGlobalTimeout</span><span class="p">(</span><span class="n">timeLimit</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setSolutionTimeout</span><span class="p">(</span><span class="n">timeLimit_per_solution</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setMaxSolutionCount</span><span class="p">(</span><span class="n">max_sol_count</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setShowSolutions</span><span class="p">(</span><span class="n">showSolutions</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setVAC</span><span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">vac</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setSeed</span><span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">setVerbose</span><span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">computeSupportedPoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="p">,</span> <span class="n">first_criterion</span><span class="p">,</span> <span class="n">second_criterion</span><span class="p">,</span> <span class="p">(</span><span class="n">optim_dir_first</span><span class="p">,</span><span class="n">optim_dir_second</span><span class="p">))</span>
        <span class="c1"># tb2.Bicriteria.computeNonSupported(self.MultiCFN, (optim_dir_first,optim_dir_second), 500)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">getSolutions</span><span class="p">(),</span> <span class="n">tb2</span><span class="o">.</span><span class="n">Bicriteria</span><span class="o">.</span><span class="n">getPoints</span><span class="p">())</span> </div>



<div class="viewcode-block" id="MultiCFN.Print">
<a class="viewcode-back" href="../ref/ref_python.html#pytoulbar2.MultiCFN.Print">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print print the content of the multiCFN: variables, cost functions.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">MultiCFN</span><span class="o">.</span><span class="n">print</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, INRAE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
        News system by <a href="https://giscus.app">giscus</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>