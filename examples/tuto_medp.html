

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mendelian error detection problem &mdash; toulbar2 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/toulbar2.css?v=4cefacce" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            toulbar2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../presentation.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmark libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userdoc.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refman.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pdfmanuals.html">Documentation in pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">toulbar2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div class=toulbar2header>

  <div class="toulbar2logo">

    <h1>toulbar2</h1>
    <h2>An exact solver for cost function networks</h2>

  </div>

  <div class=toulbar2headerline>

    <a href=../presentation.html>Presentation</a> |
    <a href=../downloads.html>Downloads</a> |
    <a href=../benchmarks.html>Benchmarks</a> |
    <a href=tutorials.html>Tutorials</a> |
    <a href=usecases.html>Use cases</a> |
    <a href=../userdoc.html>User</a> |
    <a href=../refman.html>Reference</a> |
    <a href=../pdfmanuals.html>Doc in pdf</a> |
    <a href=../publications.html>Publications</a>

  </div>

</div>

<!-- News : see news_*.rst pages -->

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mendelian-error-detection-problem">
<span id="tuto-medp"></span><h1>Mendelian error detection problem<a class="headerlink" href="#mendelian-error-detection-problem" title="Link to this heading"></a></h1>
<div align=right>
    <span style="color:Firebrick; font-weight:bold;"> Back to </span>
    <a href="tutorials.html">Tutorials</a> |
    <a href="usecases.html">Use cases</a>
</div><section id="brief-description">
<h2>Brief description<a class="headerlink" href="#brief-description" title="Link to this heading"></a></h2>
<p>The problem is to detect marker genotyping incompatibilities (Mendelian errors) in complex pedigrees.
The input is a pedigree data with partial observed genotyping data at a single locus, we assume the pedigree to be exact, but not the genotyping data.
The problem is to assign genotypes (unordered pairs of alleles) to all individuals such that they are compatible with the Mendelian law of heredity (one allele is the same as their father’s and one as their mother’s). The goal is to maximize the number of matching alleles between the genotyping data and the solution. Each difference from the genotyping data has a cost of 1.</p>
<p><a class="reference external" href="https://miat.inrae.fr/degivry/Sanchez07a.pdf">Sanchez, M., de Givry, S. and Schiex, T. Constraints (2008) 13:130</a>.</p>
</section>
<section id="cfn-model">
<h2>CFN model<a class="headerlink" href="#cfn-model" title="Link to this heading"></a></h2>
<p>We create N variables, one for each individual genotype with domain being all possible unordered pairs of existing alleles.
Hard ternary cost functions express mendelian law of heredity (one allele is the same as their father’s and one as their mother’s, with mother and father defined in the pedigree data).
For each genotyping data, we create one unary soft constraint with violation cost equal to 1 to represent the matching between the genotyping data and the solution.</p>
</section>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Link to this heading"></a></h2>
<p>Original data files can be download from the cost function library <a class="reference external" href="https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/real/pedigree/data/pre">pedigree</a>. Their format is described <a class="reference external" href="http://miat.inrae.fr/MendelSoft">here</a>. You can try a small example simple.pre (<a class="reference download internal" download="" href="../_downloads/8786c0bfc5f17e9057ca698337e2ffd1/simple.pre"><code class="xref download docutils literal notranslate"><span class="pre">simple.pre</span></code></a>) with optimum value equal to 1.</p>
</section>
<section id="python-model">
<h2>Python model<a class="headerlink" href="#python-model" title="Link to this heading"></a></h2>
<p>The following code solves the corresponding cost function network using the pytoulbar2 library (e.g. “python3 mendel.py simple.pre”).</p>
<p><a class="reference download internal" download="" href="../_downloads/c14da12678479da1f2ece1e5da10f623/mendel.py"><code class="xref download docutils literal notranslate"><span class="pre">mendel.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytoulbar2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Data</span><span class="p">:</span>
	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ped</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">father</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mother</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">allelesId</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ListAlle</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ped</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
			<span class="p">(</span><span class="n">locus</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">father</span><span class="p">,</span> <span class="n">mother</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">allele1</span><span class="p">,</span> <span class="n">allele2</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">father</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">father</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mother</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mother</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">allelesId</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">))</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">))</span>
			<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ListAlle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ListAlle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">allele2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1">#collect data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">obs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Problem</span> <span class="o">=</span> <span class="n">pytoulbar2</span><span class="o">.</span><span class="n">CFN</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

<span class="c1">#create a variable for each individual</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
	<span class="n">domains</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span><span class="p">:</span>
				<span class="n">domains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>
	<span class="n">Problem</span><span class="o">.</span><span class="n">AddVariable</span><span class="p">(</span><span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">,</span> <span class="n">domains</span><span class="p">)</span>

<span class="c1">#create the constraints that represent the mendel&#39;s laws</span>
<span class="n">ListConstraintsMendelLaw</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">p1</span> <span class="o">&lt;=</span> <span class="n">p2</span><span class="p">:</span>	<span class="c1"># father alleles</span>
			<span class="k">for</span> <span class="n">m1</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">m2</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">m1</span> <span class="o">&lt;=</span> <span class="n">m2</span><span class="p">:</span>	<span class="c1"># mother alleles</span>
						<span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
							<span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span><span class="p">:</span>	<span class="c1"># child alleles</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">a1</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">in</span> <span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">a2</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a1</span> <span class="ow">in</span> <span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">))</span> <span class="p">:</span>
										<span class="n">ListConstraintsMendelLaw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
									<span class="k">else</span> <span class="p">:</span>
									 	<span class="n">ListConstraintsMendelLaw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
	<span class="c1">#ternary constraints representing mendel&#39;s laws</span>
	<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">father</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">mother</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">Problem</span><span class="o">.</span><span class="n">AddFunction</span><span class="p">([</span><span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">father</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">data</span><span class="o">.</span><span class="n">mother</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="n">ListConstraintsMendelLaw</span><span class="p">)</span>
		
	<span class="c1">#unary constraints linked to the observations</span>
	<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">allelesId</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">allelesId</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">ListConstraintsObservation</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">ListAlle</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">a1</span> <span class="o">&lt;=</span> <span class="n">a2</span><span class="p">:</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">allelesId</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
						<span class="n">ListConstraintsObservation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
					<span class="k">else</span> <span class="p">:</span>
					 	<span class="n">ListConstraintsObservation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">Problem</span><span class="o">.</span><span class="n">AddFunction</span><span class="p">([</span><span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="n">ListConstraintsObservation</span><span class="p">)</span>

<span class="c1">#Problem.Dump(&#39;Mendel.cfn&#39;)</span>
<span class="n">Problem</span><span class="o">.</span><span class="n">CFN</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">Problem</span><span class="o">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">showSolutions</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">if</span> <span class="n">res</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are&#39;</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;difference(s) between the solution and the observation.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No solution found&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, INRAE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
        News system by <a href="https://giscus.app">giscus</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>